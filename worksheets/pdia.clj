;; gorilla-repl.fileformat = 1

;; **
;;; # Probabilistic Deterministic Infinite Automata
;;; 
;;; Shift + enter evaluates code. Click the menu icon for more commands ...
;;; 
;;; First we set up the Anglican and Clojure namespaces.  Also Gorilla plotting.
;; **

;; @@
(ns pdia
  (:require [gorilla-plot.core :as plot])
  (:use clojure.repl
        [mrepl core]
        [embang runtime emit]
        [anglib crp]
        [clojure.string :only (join split blank?)]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Now we define a true data generating process -- the even process, a two-state probabilistic deterministic automaton that emits stochastic character sequences consisting of two different characters, here one \a (note that \a is the character a in Clojure), the other \b.  Notably the sequences contain only even subsequences of one of the characters, here \b.
;; **

;; @@
(defn even 
  ([] (even 0)) 
  ([state]
   (if (= state 0)
     (let [ret (if (sample (flip 0.6)) \a \b)]
       (if (= ret \a)
             ; if in 0 and a is emitted then stay in 0
             (cons \a (lazy-seq (even 0)))    
             ; otherwise switch states 
          	 (cons \b (lazy-seq (even 1)))))

     (do
       ; if in 1 emit a 
       (cons \b (lazy-seq (even 0)))))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;pdia/even</span>","value":"#'pdia/even"}
;; <=

;; **
;;; We can look at what the even process looks like by "simulating" from it some N number of observations, note the number of consecutive \b's in each of the sequences
;; **

;; @@
(take 200 (even))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\b</span>","value":"\\b"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"},{"type":"html","content":"<span class='clj-char'>\\a</span>","value":"\\a"}],"value":"(\\b \\b \\b \\b \\a \\b \\b \\a \\b \\b \\a \\b \\b \\a \\a \\b \\b \\a \\b \\b \\a \\b \\b \\b \\b \\b \\b \\b \\b \\a \\a \\a \\b \\b \\a \\a \\a \\a \\b \\b \\b \\b \\a \\b \\b \\a \\a \\a \\a \\a \\a \\a \\a \\b \\b \\b \\b \\a \\a \\b \\b \\b \\b \\b \\b \\a \\b \\b \\a \\a \\b \\b \\b \\b \\a \\b \\b \\a \\a \\a \\a \\b \\b \\b \\b \\a \\a \\b \\b \\a \\a \\b \\b \\a \\a \\a \\a \\b \\b \\b \\b \\a \\b \\b \\a \\b \\b \\a \\a \\a \\a \\a \\a \\a \\a \\a \\b \\b \\a \\a \\a \\b \\b \\a \\b \\b \\a \\a \\a \\b \\b \\a \\a \\b \\b \\a \\b \\b \\b \\b \\a \\b \\b \\a \\b \\b \\b \\b \\a \\a \\a \\a \\a \\a \\a \\b \\b \\b \\b \\a \\b \\b \\a \\a \\b \\b \\a \\b \\b \\b \\b \\a \\b \\b \\b \\b \\a \\b \\b \\a \\a \\a \\b \\b \\a \\b \\b \\a \\a \\a \\a \\a \\b \\b \\a \\b \\b \\a \\a \\a)"}
;; <=

;; **
;;; 
;; **

;; **
;;; Since it's a bit difficult to see by eye in long sequences, let's build up some processing code, mostly to detect whether the number of consecutive b's in sequences emitted by the automata we're going to learn is even. We'll use these functions again later.
;; **

;; @@
(def run-length-counts
  (map #(list (first %) (count %)) 
        (partition-by identity (even))))
(take 100 run-length-counts)
(def b-runs (filter #(= \b (first %)) run-length-counts))
(take 100 b-runs)
(def odd-b-runs (map #(mod (second %) 2) (butlast (take 10000 b-runs))))
;odd-b-runs
; don't count the last one because it could get cut off  
(def fraction-odd (/ (reduce + (butlast odd-b-runs)) (count (butlast odd-b-runs))))
fraction-odd

;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}
;; <=

;; **
;;; Now that we have a data source (even), we can try to learn the structure of the automata.
;; **

;; @@
(with-primitive-procedures [join even]
  (defquery pdia N 
    "pdia: doc string"
    (let [data (take N (even))
          vocabulary (distinct data)
          model-prior (dirichlet (repeat (count vocabulary) 1.))

          alpha 1.
          top-level (crp alpha)

          alpha0 1.
          symbol->state-generator
          (mem (fn [symbol] (DPmem alpha0 top-level)))

          state-symbol->next-state
          (mem (fn [state symbol] ((symbol->state-generator symbol))))

          state->observation-model
          (mem (fn [state] (sample model-prior)))

          observation-noise 
          (mem (fn [state]
                 (categorical (map vector
                                   vocabulary
                                   (state->observation-model state)))))
          sample-words
          (fn sample-words [state]
            (when (sample (flip 0.8))
              (let [word (sample (observation-noise state))]
                (conj
                  (sample-words (state-symbol->next-state state word))
                  word))))]

      (reduce (fn [state symbol]
                (observe (observation-noise state) symbol)
                (state-symbol->next-state state symbol))
              0 data)

      (predict :words (join (sample-words 0))))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;pdia/pdia</span>","value":"#'pdia/pdia"}
;; <=

;; @@
(def sampler (doquery :lmh pdia 1000))
(def t (take 500 (map get-predicts sampler)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;pdia/t</span>","value":"#'pdia/t"}
;; <=

;; @@
(def s (take-nth 2 (drop 50 (map :words t))))
s
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;baabaabbbaba&quot;</span>","value":"\"baabaabbbaba\""},{"type":"html","content":"<span class='clj-string'>&quot;baabaabbbaaa&quot;</span>","value":"\"baabaabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabaabbbaaa&quot;</span>","value":"\"baabaabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbbaaa&quot;</span>","value":"\"baabbabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbbaaa&quot;</span>","value":"\"baabbabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbbaaa&quot;</span>","value":"\"baabbabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbbaaa&quot;</span>","value":"\"baabbabbbaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;baabbabbaaaa&quot;</span>","value":"\"baabbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbabbaaaa&quot;</span>","value":"\"babbbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbabbaaaa&quot;</span>","value":"\"babbbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbabbaaaa&quot;</span>","value":"\"babbbabbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbabaaaa&quot;</span>","value":"\"babbbbabaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbabaaaa&quot;</span>","value":"\"babbbbabaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbabaaaa&quot;</span>","value":"\"babbbbabaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbabaaaa&quot;</span>","value":"\"babbbbabaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbaaaaaa&quot;</span>","value":"\"babbbbaaaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbaaaaaa&quot;</span>","value":"\"babbbbaaaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbaaaa&quot;</span>","value":"\"babbbbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbaaaa&quot;</span>","value":"\"babbbbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;babbbbaaaa&quot;</span>","value":"\"babbbbaaaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bab&quot;</span>","value":"\"bab\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;baab&quot;</span>","value":"\"baab\""},{"type":"html","content":"<span class='clj-string'>&quot;baab&quot;</span>","value":"\"baab\""},{"type":"html","content":"<span class='clj-string'>&quot;baab&quot;</span>","value":"\"baab\""},{"type":"html","content":"<span class='clj-string'>&quot;baab&quot;</span>","value":"\"baab\""},{"type":"html","content":"<span class='clj-string'>&quot;baab&quot;</span>","value":"\"baab\""},{"type":"html","content":"<span class='clj-string'>&quot;babb&quot;</span>","value":"\"babb\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbaaababbaa&quot;</span>","value":"\"bbbbaaababbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbaaababbaa&quot;</span>","value":"\"bbbbaaababbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaaababbaa&quot;</span>","value":"\"bbabaaababbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaabbabbaa&quot;</span>","value":"\"bbabaabbabbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaabbabbaa&quot;</span>","value":"\"bbabaabbabbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaabbabbaa&quot;</span>","value":"\"bbabaabbabbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaabbabbaa&quot;</span>","value":"\"bbabaabbabbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaabbabbaa&quot;</span>","value":"\"bbabaabbabbaa\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabaab&quot;</span>","value":"\"bbabaab\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;bba&quot;</span>","value":"\"bba\""},{"type":"html","content":"<span class='clj-string'>&quot;bba&quot;</span>","value":"\"bba\""},{"type":"html","content":"<span class='clj-string'>&quot;bba&quot;</span>","value":"\"bba\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;a&quot;</span>","value":"\"a\""},{"type":"html","content":"<span class='clj-string'>&quot;aabb&quot;</span>","value":"\"aabb\""},{"type":"html","content":"<span class='clj-string'>&quot;aaba&quot;</span>","value":"\"aaba\""},{"type":"html","content":"<span class='clj-string'>&quot;aaba&quot;</span>","value":"\"aaba\""},{"type":"html","content":"<span class='clj-string'>&quot;ab&quot;</span>","value":"\"ab\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;ba&quot;</span>","value":"\"ba\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;bb&quot;</span>","value":"\"bb\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;bbabbbbb&quot;</span>","value":"\"bbabbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbbbbb&quot;</span>","value":"\"bbbbbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbbbbb&quot;</span>","value":"\"bbbbbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbbbbb&quot;</span>","value":"\"bbbbbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbbbbbb&quot;</span>","value":"\"bbbbbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbabbbb&quot;</span>","value":"\"bbbabbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbabbbb&quot;</span>","value":"\"bbbabbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbabbbb&quot;</span>","value":"\"bbbabbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbabbbb&quot;</span>","value":"\"bbbabbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbbabbbbb&quot;</span>","value":"\"bbbabbbbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;bbb&quot;</span>","value":"\"bbb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;abb&quot;</span>","value":"\"abb\""},{"type":"html","content":"<span class='clj-string'>&quot;aba&quot;</span>","value":"\"aba\""},{"type":"html","content":"<span class='clj-string'>&quot;aba&quot;</span>","value":"\"aba\""},{"type":"html","content":"<span class='clj-string'>&quot;aba&quot;</span>","value":"\"aba\""},{"type":"html","content":"<span class='clj-string'>&quot;aba&quot;</span>","value":"\"aba\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;&quot;</span>","value":"\"\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""}],"value":"(\"baabaabbbaba\" \"baabaabbbaaa\" \"baabaabbbaaa\" \"baabbabbbaaa\" \"baabbabbbaaa\" \"baabbabbbaaa\" \"baabbabbbaaa\" \"baabbabbaaaa\" \"baabbabbaaaa\" \"baabbabbaaaa\" \"baabbabbaaaa\" \"baabbabbaaaa\" \"baabbabbaaaa\" \"babbbabbaaaa\" \"babbbabbaaaa\" \"babbbabbaaaa\" \"babbbbabaaaa\" \"babbbbabaaaa\" \"babbbbabaaaa\" \"babbbbabaaaa\" \"babbbbaaaaaa\" \"babbbbaaaaaa\" \"babbbbaaaa\" \"babbbbaaaa\" \"babbbbaaaa\" \"bab\" \"babb\" \"babb\" \"babb\" \"babb\" \"babb\" \"baab\" \"baab\" \"baab\" \"baab\" \"baab\" \"babb\" \"b\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"bb\" \"bb\" \"bbbbaaababbaa\" \"bbbbaaababbaa\" \"bbabaaababbaa\" \"bbabaabbabbaa\" \"bbabaabbabbaa\" \"bbabaabbabbaa\" \"bbabaabbabbaa\" \"bbabaabbabbaa\" \"bbabaab\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"bba\" \"bba\" \"bba\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"a\" \"a\" \"a\" \"a\" \"a\" \"a\" \"a\" \"a\" \"aabb\" \"aaba\" \"aaba\" \"ab\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"ba\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"ba\" \"ba\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"bb\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"b\" \"bbabbbbb\" \"bbbbbbbb\" \"bbbbbbbb\" \"bbbbbbbb\" \"bbbbbbbb\" \"bbbabbbb\" \"bbbabbbb\" \"bbbabbbb\" \"bbbabbbb\" \"bbbabbbbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"bbb\" \"abb\" \"abb\" \"abb\" \"abb\" \"abb\" \"abb\" \"aba\" \"aba\" \"aba\" \"aba\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"b\" \"b\" \"b\" \"b\" \"b\")"}
;; <=

;; @@
(defn strings [n s]
  (take-nth 100 (drop (/ n 10.) (map :words (take n (map get-predicts s))))))
(defn non-empty-strings [n s] (filter #(not (blank? %)) (strings n s)))

(defn run-length-counts [x]
  (map #(list (first %) (count %)) 
        (partition-by identity x)))

(defn b-runs [x] 
  (filter #(= \b (first %)) x))

(defn odd-b-runs [x] 
  (map #(mod (second %) 2) (rest (butlast (b-runs x)))))

(defn fraction [x] 
  (/ (reduce + (odd-b-runs x)) (count (odd-b-runs x))))

(defn fraction-odd [n s] 
  (float (fraction 
     (reduce concat 
        (map run-length-counts (map seq (non-empty-strings n s)))))))
(fraction-odd 500000 samples)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;pdia/fraction-odd</span>","value":"#'pdia/fraction-odd"}
;; <=

;; @@
(def fraction-odd-as-function-of-training-data-length 
  (loop [N 2 purities {}]
  (if (> N 70000)
    purities
    (let [samples (doquery :lmh pdia N)
          fo (fraction-odd 50000 samples)]
       (prn N)
       (recur (* N 2) (conj purities {N fo}))))))
;; @@

;; @@
(plot/list-plot (sort fraction-odd-as-function-of-training-data-length) :joined true)
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"0056d167-15a3-41cc-b519-7205aaee94d0","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"0056d167-15a3-41cc-b519-7205aaee94d0","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"0056d167-15a3-41cc-b519-7205aaee94d0"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"0056d167-15a3-41cc-b519-7205aaee94d0","values":[{"x":2,"y":0.6111111044883728},{"x":4,"y":0.6454545259475708},{"x":8,"y":0.6194690465927124},{"x":16,"y":0.6666666865348816},{"x":32,"y":0.6145833134651184},{"x":64,"y":0.31182795763015747},{"x":128,"y":0.4189189076423645},{"x":256,"y":0.4691357910633087},{"x":512,"y":0.3571428656578064},{"x":1024,"y":0.41489362716674805},{"x":2048,"y":0.5099999904632568},{"x":4096,"y":0.3333333432674408},{"x":8192,"y":0.46875},{"x":16384,"y":0.5617977380752563},{"x":32768,"y":0.44086021184921265}]}],"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"0056d167-15a3-41cc-b519-7205aaee94d0\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"0056d167-15a3-41cc-b519-7205aaee94d0\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"0056d167-15a3-41cc-b519-7205aaee94d0\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"0056d167-15a3-41cc-b519-7205aaee94d0\", :values ({:x 2, :y 0.6111111} {:x 4, :y 0.6454545} {:x 8, :y 0.61946905} {:x 16, :y 0.6666667} {:x 32, :y 0.6145833} {:x 64, :y 0.31182796} {:x 128, :y 0.4189189} {:x 256, :y 0.4691358} {:x 512, :y 0.35714287} {:x 1024, :y 0.41489363} {:x 2048, :y 0.51} {:x 4096, :y 0.33333334} {:x 8192, :y 0.46875} {:x 16384, :y 0.56179774} {:x 32768, :y 0.4408602})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; @@

;; @@
